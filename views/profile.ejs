<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile | ShortLink</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
        body {
            font-family: 'Fredoka One', cursive;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col bg-[#FFF5D1] text-black antialiased">
    
    <% if (typeof error !== 'undefined' && error) { %>
        <div id="toast-error" class="fixed top-24 right-8 z-50 bg-[#FF5555] border-4 border-black text-black px-6 py-4 rounded-2xl shadow-[6px_6px_0_0_rgba(0,0,0,1)] flex items-center gap-3 animate-[slideIn_0.3s_ease-out]">
            <i class="ri-error-warning-fill text-2xl"></i>
            <p class="font-normal text-lg"><%= error %></p>
            <button onclick="document.getElementById('toast-error').remove()" class="ml-4 hover:scale-110 transition-transform outline-none">
                <i class="ri-close-circle-fill text-2xl"></i>
            </button>
        </div>
        <style>
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        </style>
        <script>
            setTimeout(() => {
                const toast = document.getElementById('toast-error');
                if(toast) {
                    toast.style.opacity = '0';
                    toast.style.transition = 'opacity 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 4000);
        </script>
    <% } %>

    <!-- Navbar -->
    <nav class="w-full px-4 md:px-8 py-3 md:py-5 bg-[#FFD166] border-b-4 border-black flex justify-between items-center fixed top-0 left-0 z-50">
        <a href="/" class="text-2xl md:text-3xl tracking-wide text-black drop-shadow-[2px_2px_0_#FFF]">ShortLink</a>
        <div class="flex items-center gap-2 md:gap-6">
            <a href="/" class="hidden sm:block text-lg md:text-xl text-black hover:text-white hover:drop-shadow-[2px_2px_0_#000] transition-all">Home</a>
            
            <div class="flex items-center gap-2 md:gap-4 border-l-4 border-black pl-3 md:pl-6 ml-1 md:ml-2">
                <a href="/profile" title="Profile" class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full bg-[#118AB2] border-2 border-black text-white hover:bg-white hover:text-black hover:scale-110 transition-all shadow-[2px_2px_0_0_#000] md:shadow-[3px_3px_0_0_#000]">
                    <i class="ri-user-smile-fill text-lg md:text-xl"></i>
                </a>
                <a href="/logout" title="Logout" class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full bg-[#EF476F] border-2 border-black text-white hover:bg-white hover:text-black hover:scale-110 transition-all shadow-[2px_2px_0_0_#000] md:shadow-[3px_3px_0_0_#000]">
                    <i class="ri-logout-box-r-fill text-lg md:text-xl"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="flex-grow flex flex-col md:flex-row items-start justify-center pt-24 md:pt-32 pb-12 px-4 gap-6 md:gap-8 max-w-6xl mx-auto w-full relative">
        
        <!-- Profile Credentials Card -->
        <div class="w-full md:w-1/3 bg-white shadow-[8px_8px_0_0_#000] rounded-[2rem] p-6 md:p-8 border-4 border-black relative z-10">
            <div class="flex flex-col items-center text-center">
                <div class="w-24 h-24 bg-[#06D6A0] rounded-full border-4 border-black flex items-center justify-center mb-6 shadow-[4px_4px_0_0_#000]">
                    <i class="ri-user-smile-fill text-5xl text-white drop-shadow-[2px_2px_0_#000]"></i>
                </div>
                <h2 class="text-3xl tracking-wide text-black mb-1"><%= user.name || 'User' %></h2>
                <p class="text-gray-700 text-lg mb-6"><%= user.email %></p>
            </div>
            
            <div class="border-t-4 border-dashed border-gray-300 pt-6 mt-2">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-lg text-black">Total Links Created</span>
                    <span class="px-4 py-1 bg-[#FFD166] text-black border-2 border-black shadow-[2px_2px_0_0_#000] rounded-xl text-xl"><%= links.length %></span>
                </div>
                <button onclick="window.location.href='/logout'" class="w-full mt-2 py-3 rounded-xl bg-white border-4 border-black text-[#EF476F] hover:bg-[#EF476F] hover:text-white text-xl tracking-wide shadow-[4px_4px_0_0_#000] hover:shadow-none hover:translate-y-[4px] hover:translate-x-[4px] transition-all">
                    Log Out
                </button>
            </div>
        </div>

        <!-- User Links Table -->
        <div class="w-full md:w-2/3 bg-white shadow-[8px_8px_0_0_#000] rounded-[2rem] p-6 md:p-8 border-4 border-black relative z-10">
            <div class="flex justify-between items-center mb-6 md:mb-8">
                <h3 class="text-2xl md:text-3xl tracking-wide text-black flex items-center gap-2 md:gap-3">
                    <div class="w-8 h-8 md:w-10 md:h-10 bg-[#FFD166] border-2 border-black rounded-lg flex items-center justify-center shadow-[2px_2px_0_0_#000]">
                        <i class="ri-link text-xl md:text-2xl text-black"></i>
                    </div> 
                    Your Links
                </h3>
            </div>

            <% if (links && links.length > 0) { %>
                <div class="space-y-6">
                    <% links.reverse().forEach(link => { %>
                        <div class="bg-[#FFF5D1] border-4 border-black p-5 rounded-2xl flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 shadow-[4px_4px_0_0_#000] hover:translate-x-[-2px] hover:translate-y-[-2px] hover:shadow-[6px_6px_0_0_#000] transition-all">
                            <div class="flex-grow min-w-0 pr-4 w-full">
                                <h4 class="text-black text-xl truncate mb-2"><%= link.originalUrl %></h4>
                                <% 
                                   const path = '/' + link.alias + '/' + link.shortUrl; 
                                %>
                                <div class="flex items-center gap-2">
                                    <a href="<%= path %>" target="_blank" class="text-lg text-[#118AB2] hover:text-[#EF476F] hover:underline underline-offset-4 decoration-2 truncate transition-colors font-sans font-bold">localhost:3000<%= path %></a>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-3 shrink-0 self-end sm:self-auto">
                                <button onclick="copyLink('http://localhost:3000<%= path %>', this)" class="w-12 h-12 rounded-xl bg-white border-4 border-black flex items-center justify-center text-black hover:bg-[#FFD166] shadow-[2px_2px_0_0_#000] active:shadow-none active:translate-y-[2px] active:translate-x-[2px] transition-all group" title="Copy Link">
                                    <i class="ri-clipboard-line text-2xl group-active:scale-90 transition-transform"></i>
                                </button>
                                <a href="<%= path %>" target="_blank" class="w-12 h-12 rounded-xl bg-white border-4 border-black flex items-center justify-center text-black hover:bg-[#06D6A0] shadow-[2px_2px_0_0_#000] active:shadow-none active:translate-y-[2px] active:translate-x-[2px] transition-all group" title="Visit Link">
                                    <i class="ri-external-link-line text-2xl group-active:scale-90 transition-transform"></i>
                                </a>
                            </div>
                        </div>
                    <% }) %>
                </div>
            <% } else { %>
                <div class="text-center py-10 md:py-16 px-4 border-4 border-dashed border-gray-300 rounded-2xl bg-[#FFF9E6]">
                    <div class="w-20 h-20 rounded-full bg-white border-4 border-black flex items-center justify-center mx-auto mb-6 shadow-[4px_4px_0_0_#000] rotate-[-10deg]">
                        <i class="ri-link-unlink-line text-4xl text-[#EF476F]"></i>
                    </div>
                    <h4 class="text-2xl tracking-wide text-black mb-3">No Links Yet</h4>
                    <p class="text-gray-700 text-lg mb-8 max-w-sm mx-auto font-sans font-medium">You haven't squashed any URLs yet. Head back home to create your first mighty custom link!</p>
                    <a href="/" class="inline-flex items-center justify-center px-8 py-4 rounded-xl bg-[#06D6A0] border-4 border-black text-black text-xl tracking-wide shadow-[4px_4px_0_0_#000] hover:shadow-none hover:translate-y-[4px] hover:translate-x-[4px] transition-all">
                        Create a Link
                    </a>
                </div>
            <% } %>
        </div>
        
    </div>

    <script>
        function copyLink(url, btnElement) {
            const tempInput = document.createElement("input");
            tempInput.value = url;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            
            // Visual feedback
            const icon = btnElement.querySelector('i');
            const originalClass = icon.className;
            
            icon.className = 'ri-check-line text-black scale-110 text-2xl';
            btnElement.classList.add('bg-[#06D6A0]');
            
            setTimeout(() => {
                icon.className = originalClass;
                btnElement.classList.remove('bg-[#06D6A0]');
            }, 2000);
        }
    </script>

</body>
</html>
